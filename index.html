<!DOCTYPE html>
<html lang="en">
<head>
  <meta charset="UTF-8" />
  <meta name="viewport" content="width=device-width, initial-scale=1.0" />
  <title>What Would Keanu Do?</title>
  <meta name="description" content="Ask a life question. Receive grounded, quietly profound wisdom." />
  <meta property="og:title" content="What Would Keanu Do?" />
  <meta property="og:description" content="Ask a life question. Receive grounded, quietly profound wisdom." />
  <meta property="og:url" content="https://whatwouldkeanudo.com" />

  <link rel="preconnect" href="https://fonts.googleapis.com" />
  <link rel="preconnect" href="https://fonts.gstatic.com" crossorigin />
  <link href="https://fonts.googleapis.com/css2?family=Lora:ital,wght@0,400;0,500;1,400&family=DM+Sans:wght@300;400;500&display=swap" rel="stylesheet" />

  <style>
    *, *::before, *::after {
      box-sizing: border-box;
      margin: 0;
      padding: 0;
    }

    :root {
      --bg: #111009;
      --bg-card: #1a1710;
      --amber: #c8963e;
      --amber-light: #e0b060;
      --amber-dim: #8a6420;
      --text: #e8dfc8;
      --text-muted: #9a9080;
      --text-dim: #5a5448;
      --border: #2e2a22;
      --radius: 12px;
    }

    html, body {
      height: 100%;
    }

    body {
      background: var(--bg);
      color: var(--text);
      font-family: 'DM Sans', sans-serif;
      min-height: 100vh;
      display: flex;
      flex-direction: column;
      position: relative;
      overflow-x: hidden;
    }

    /* Ambient background particles */
    #canvas {
      position: fixed;
      inset: 0;
      z-index: 0;
      pointer-events: none;
      opacity: 0.45;
    }

    /* Subtle radial glow */
    body::before {
      content: '';
      position: fixed;
      top: -30%;
      left: 50%;
      transform: translateX(-50%);
      width: 80vw;
      height: 60vw;
      background: radial-gradient(ellipse at center, rgba(180, 130, 40, 0.06) 0%, transparent 70%);
      pointer-events: none;
      z-index: 0;
    }

    /* Layout */
    header {
      position: relative;
      z-index: 1;
      padding: 2.5rem 2rem 0;
      text-align: center;
    }

    .logo {
      font-family: 'DM Sans', sans-serif;
      font-weight: 300;
      font-size: 0.72rem;
      letter-spacing: 0.3em;
      text-transform: uppercase;
      color: var(--amber-dim);
      text-decoration: none;
    }

    .logo span {
      color: var(--amber);
    }

    main {
      position: relative;
      z-index: 1;
      flex: 1;
      display: flex;
      flex-direction: column;
      align-items: center;
      justify-content: center;
      padding: 3rem 1.5rem 4rem;
      gap: 0;
    }

    .headline {
      text-align: center;
      margin-bottom: 3rem;
    }

    .headline h1 {
      font-family: 'Lora', serif;
      font-weight: 400;
      font-size: clamp(2rem, 6vw, 3.4rem);
      color: var(--text);
      line-height: 1.2;
      letter-spacing: -0.01em;
    }

    .headline h1 em {
      font-style: italic;
      color: var(--amber-light);
    }

    .headline p {
      margin-top: 1rem;
      font-size: 0.95rem;
      color: var(--text-muted);
      font-weight: 300;
      letter-spacing: 0.02em;
    }

    /* Question form */
    .ask-form {
      width: 100%;
      max-width: 640px;
    }

    .example-prompt {
      font-size: 0.8rem;
      color: var(--text-dim);
      margin-bottom: 0.75rem;
      padding-left: 0.25rem;
      letter-spacing: 0.02em;
      min-height: 1.2em;
      transition: opacity 0.4s;
    }

    .example-prompt span {
      color: var(--amber-dim);
      cursor: pointer;
      transition: color 0.2s;
    }

    .example-prompt span:hover {
      color: var(--amber);
    }

    .input-row {
      display: flex;
      gap: 0.75rem;
      align-items: stretch;
    }

    textarea {
      flex: 1;
      background: var(--bg-card);
      border: 1px solid var(--border);
      border-radius: var(--radius);
      color: var(--text);
      font-family: 'DM Sans', sans-serif;
      font-size: 1rem;
      font-weight: 300;
      padding: 1rem 1.25rem;
      resize: none;
      min-height: 60px;
      max-height: 160px;
      line-height: 1.6;
      outline: none;
      transition: border-color 0.2s, box-shadow 0.2s;
      overflow-y: auto;
    }

    textarea::placeholder {
      color: var(--text-dim);
    }

    textarea:focus {
      border-color: var(--amber-dim);
      box-shadow: 0 0 0 3px rgba(200, 150, 62, 0.08);
    }

    .submit-btn {
      background: var(--amber);
      border: none;
      border-radius: var(--radius);
      color: #111009;
      cursor: pointer;
      font-family: 'DM Sans', sans-serif;
      font-size: 0.85rem;
      font-weight: 500;
      letter-spacing: 0.04em;
      padding: 0 1.5rem;
      white-space: nowrap;
      transition: background 0.2s, transform 0.1s;
      align-self: flex-end;
      min-height: 60px;
    }

    .submit-btn:hover:not(:disabled) {
      background: var(--amber-light);
    }

    .submit-btn:active:not(:disabled) {
      transform: scale(0.97);
    }

    .submit-btn:disabled {
      background: var(--amber-dim);
      cursor: not-allowed;
      opacity: 0.6;
    }

    /* Response area */
    .response-area {
      width: 100%;
      max-width: 640px;
      margin-top: 2.5rem;
    }

    .response-card {
      background: var(--bg-card);
      border: 1px solid var(--border);
      border-radius: var(--radius);
      padding: 2rem 2.25rem;
      position: relative;
      overflow: hidden;
      opacity: 0;
      transform: translateY(12px);
      transition: opacity 0.5s ease, transform 0.5s ease;
    }

    .response-card.visible {
      opacity: 1;
      transform: translateY(0);
    }

    /* Subtle amber left border accent */
    .response-card::before {
      content: '';
      position: absolute;
      left: 0;
      top: 1.5rem;
      bottom: 1.5rem;
      width: 2px;
      background: linear-gradient(to bottom, transparent, var(--amber-dim), transparent);
      border-radius: 1px;
    }

    .response-text {
      font-family: 'Lora', serif;
      font-size: clamp(1.05rem, 2.5vw, 1.2rem);
      line-height: 1.8;
      color: var(--text);
      font-weight: 400;
      min-height: 1.8em;
    }

    .response-text.streaming::after {
      content: '▌';
      color: var(--amber);
      animation: blink 1s step-end infinite;
      margin-left: 2px;
    }

    @keyframes blink {
      0%, 100% { opacity: 1; }
      50% { opacity: 0; }
    }

    .response-actions {
      display: flex;
      align-items: center;
      justify-content: space-between;
      margin-top: 1.5rem;
      padding-top: 1.25rem;
      border-top: 1px solid var(--border);
    }

    .ask-another {
      background: none;
      border: 1px solid var(--border);
      border-radius: 8px;
      color: var(--text-muted);
      cursor: pointer;
      font-family: 'DM Sans', sans-serif;
      font-size: 0.82rem;
      font-weight: 400;
      letter-spacing: 0.04em;
      padding: 0.55rem 1rem;
      transition: border-color 0.2s, color 0.2s;
    }

    .ask-another:hover {
      border-color: var(--amber-dim);
      color: var(--amber-light);
    }

    .share-btn {
      background: none;
      border: none;
      color: var(--text-dim);
      cursor: pointer;
      font-family: 'DM Sans', sans-serif;
      font-size: 0.82rem;
      font-weight: 400;
      letter-spacing: 0.04em;
      padding: 0.55rem 0.5rem;
      transition: color 0.2s;
      display: flex;
      align-items: center;
      gap: 0.4rem;
    }

    .share-btn:hover {
      color: var(--amber);
    }

    .share-btn svg {
      width: 14px;
      height: 14px;
    }

    /* Thinking indicator */
    .thinking {
      display: none;
      align-items: center;
      gap: 0.5rem;
      color: var(--text-muted);
      font-size: 0.85rem;
      font-weight: 300;
      margin-top: 1.25rem;
      padding-left: 0.25rem;
      letter-spacing: 0.02em;
    }

    .thinking.active {
      display: flex;
    }

    .thinking-dots {
      display: flex;
      gap: 4px;
    }

    .thinking-dots span {
      width: 5px;
      height: 5px;
      border-radius: 50%;
      background: var(--amber-dim);
      animation: pulse 1.4s ease-in-out infinite;
    }

    .thinking-dots span:nth-child(2) { animation-delay: 0.2s; }
    .thinking-dots span:nth-child(3) { animation-delay: 0.4s; }

    @keyframes pulse {
      0%, 80%, 100% { opacity: 0.3; transform: scale(0.8); }
      40% { opacity: 1; transform: scale(1); }
    }

    /* Error state */
    .error-msg {
      display: none;
      margin-top: 1rem;
      color: #c87070;
      font-size: 0.85rem;
      font-weight: 300;
      padding-left: 0.25rem;
    }

    .error-msg.visible {
      display: block;
    }

    /* GIF display */
    .response-gif {
      margin-top: 1.5rem;
      border-radius: 8px;
      overflow: hidden;
      opacity: 0;
      transform: translateY(8px);
      transition: opacity 0.5s ease 0.2s, transform 0.5s ease 0.2s;
      line-height: 0;
    }

    .response-gif.visible {
      opacity: 1;
      transform: translateY(0);
    }

    .response-gif img {
      width: 100%;
      max-width: 300px;
      height: auto;
      border-radius: 8px;
      display: block;
    }

    .response-gif a {
      display: block;
      line-height: 0;
    }

    .gif-credit {
      margin-top: 0.6rem;
      line-height: 0;
    }

    .gif-credit a {
      display: inline-block;
      opacity: 0.7;
      transition: opacity 0.2s;
      line-height: 0;
    }

    .gif-credit a:hover {
      opacity: 1;
    }

    .gif-credit img {
      height: 28px;
      width: auto;
      display: block;
      border-radius: 0;
      max-width: none;
    }

    /* Easter egg */
    .whoa-mode .response-text {
      font-style: italic;
      color: var(--amber-light);
    }

    footer {
      position: relative;
      z-index: 1;
      text-align: center;
      padding: 2rem 1.5rem;
      border-top: 1px solid var(--border);
    }

    footer p {
      font-size: 0.78rem;
      color: var(--text-dim);
      font-weight: 300;
      letter-spacing: 0.04em;
    }

    footer a {
      color: var(--amber-dim);
      text-decoration: none;
      transition: color 0.2s;
    }

    footer a:hover {
      color: var(--amber);
    }

    /* Mobile */
    @media (max-width: 500px) {
      .input-row {
        flex-direction: column;
      }

      .submit-btn {
        min-height: 48px;
        width: 100%;
      }

      .response-card {
        padding: 1.5rem 1.5rem;
      }
    }
  </style>
</head>
<body>

<canvas id="canvas"></canvas>

<header>
  <a href="/" class="logo">W W K D <span>&nbsp;·&nbsp;</span> whatwouldkeanudo.com</a>
</header>

<main>
  <div class="headline">
    <h1>What would<br><em>Keanu</em> do?</h1>
    <p>Ask anything. Receive something grounded.</p>
  </div>

  <div class="ask-form">
    <div class="example-prompt" id="examplePrompt"></div>
    <div class="input-row">
      <textarea
        id="questionInput"
        placeholder="What's on your mind?"
        rows="2"
        maxlength="500"
        autofocus
      ></textarea>
      <button class="submit-btn" id="submitBtn" aria-label="Ask Keanu">Ask</button>
    </div>
    <div class="thinking" id="thinking">
      <div class="thinking-dots">
        <span></span><span></span><span></span>
      </div>
      <span>sitting with it...</span>
    </div>
    <div class="error-msg" id="errorMsg"></div>
  </div>

  <div class="response-area" id="responseArea">
    <div class="response-card" id="responseCard">
      <p class="response-text" id="responseText"></p>
      <div class="response-gif" id="responseGif"></div>
      <div class="response-actions">
        <button class="ask-another" id="askAnother">Ask another</button>
        <button class="share-btn" id="shareBtn" title="Copy to clipboard">
          <svg viewBox="0 0 24 24" fill="none" stroke="currentColor" stroke-width="2" stroke-linecap="round" stroke-linejoin="round">
            <circle cx="18" cy="5" r="3"/><circle cx="6" cy="12" r="3"/><circle cx="18" cy="19" r="3"/>
            <line x1="8.59" y1="13.51" x2="15.42" y2="17.49"/><line x1="15.41" y1="6.51" x2="8.59" y2="10.49"/>
          </svg>
          Share
        </button>
      </div>
    </div>
  </div>
</main>

<footer>
  <p>
    whatwouldkeanudo.com &nbsp;·&nbsp;
    <a href="/about.html">about this</a>
    &nbsp;·&nbsp; the antidote to everything
  </p>
</footer>

<script>
  // ── Config ─────────────────────────────────────────────────────────────────
  // During local dev, point to the wrangler dev server.
  // In production this becomes a same-origin path: /ask
  const WORKER_URL = '/.netlify/functions/ask';

  // ── Mock mode (no Worker running) ──────────────────────────────────────────
  // Set to true to preview the UI without any API keys or Worker.
  const MOCK_MODE = false;

  const MOCK_RESPONSES = [
    "That weight you're carrying — it's real. But it doesn't have to define the whole day. Sometimes just naming it is enough to make it a little lighter.",
    "I think about that too. Whether what I'm doing means something. I don't always have an answer. But I keep showing up anyway, and somehow that feels like enough.",
    "People surprise you, if you let them. And if they don't — well, that's information too.",
    "The comparison thing is a trap. You're measuring your insides against everyone else's outside. It's not a fair contest and you already know that.",
    "Starting over isn't failure. It's just... deciding. And deciding takes more courage than most people realize.",
    "There's no behind. There's just where you are. That's always been the only place to start from.",
  ];

  const MOCK_GIFS = [
    { url: 'https://media.giphy.com/media/TJrS7r0f6SOthGTiPe/giphy.gif', title: 'Keanu Reeves', giphyPage: 'https://giphy.com/gifs/lionsgate-keanu-reeves-keanureeves-TJrS7r0f6SOthGTiPe' },
    { url: 'https://media.giphy.com/media/JCD1jbu3UgBby/giphy.gif', title: 'Keanu Reeves', giphyPage: 'https://giphy.com/gifs/giphyqa-JCD1jbu3UgBby' },
    { url: 'https://media.giphy.com/media/aDYXQy3W8XFG8/giphy.gif', title: 'Keanu Reeves Point Break', giphyPage: 'https://giphy.com/gifs/keanu-reeves-point-break-johnny-utah-aDYXQy3W8XFG8' },
    { url: 'https://media.giphy.com/media/NUwoRZzHc2Bws/giphy.gif', title: 'Keanu Reeves Wink', giphyPage: 'https://giphy.com/gifs/approved-keanu-NUwoRZzHc2Bws' },
    { url: 'https://media.giphy.com/media/DUoYMYrQ09Lh17IurF/giphy.gif', title: 'Keanu Reeves Neo', giphyPage: 'https://giphy.com/gifs/HBOMax-neo-hbo-max-upgrades-DUoYMYrQ09Lh17IurF' },
  ];

  async function mockFetch(question) {
    // Simulate network delay
    await new Promise(r => setTimeout(r, 1200));
    const wisdom = MOCK_RESPONSES[Math.floor(Math.random() * MOCK_RESPONSES.length)];
    const gif = MOCK_GIFS[Math.floor(Math.random() * MOCK_GIFS.length)];
    return { wisdom, gif };
  }

  const EXAMPLE_QUESTIONS = [
    "My boss doesn't appreciate me.",
    "I can't stop doom-scrolling.",
    "Should I quit my job?",
    "I feel like I'm behind in life.",
    "My friend group is falling apart.",
    "Is it too late to start over?",
    "I don't know what I'm doing with my life.",
    "Everything feels heavy right now.",
    "I'm afraid of being ordinary.",
    "I keep comparing myself to everyone.",
  ];

  // ── State ──────────────────────────────────────────────────────────────────
  let isLoading = false;
  let currentResponse = '';

  // ── Elements ───────────────────────────────────────────────────────────────
  const input = document.getElementById('questionInput');
  const submitBtn = document.getElementById('submitBtn');
  const responseCard = document.getElementById('responseCard');
  const responseText = document.getElementById('responseText');
  const responseGif = document.getElementById('responseGif');
  const thinkingEl = document.getElementById('thinking');
  const errorMsg = document.getElementById('errorMsg');
  const askAnother = document.getElementById('askAnother');
  const shareBtn = document.getElementById('shareBtn');
  const examplePrompt = document.getElementById('examplePrompt');

  // ── Example prompt rotation ────────────────────────────────────────────────
  function setExamplePrompt() {
    const q = EXAMPLE_QUESTIONS[Math.floor(Math.random() * EXAMPLE_QUESTIONS.length)];
    examplePrompt.innerHTML = `Try: <span id="exampleText">"${q}"</span>`;
    document.getElementById('exampleText').addEventListener('click', () => {
      input.value = q;
      input.focus();
      autoResize();
    });
  }

  setExamplePrompt();

  // ── Auto-resize textarea ───────────────────────────────────────────────────
  function autoResize() {
    input.style.height = 'auto';
    input.style.height = Math.min(input.scrollHeight, 160) + 'px';
  }

  input.addEventListener('input', autoResize);

  input.addEventListener('keydown', (e) => {
    if (e.key === 'Enter' && !e.shiftKey) {
      e.preventDefault();
      handleSubmit();
    }
  });

  submitBtn.addEventListener('click', handleSubmit);
  askAnother.addEventListener('click', resetForm);
  shareBtn.addEventListener('click', handleShare);

  // ── Easter egg ─────────────────────────────────────────────────────────────
  function isWhoa(text) {
    return text.trim().toLowerCase() === 'whoa';
  }

  // ── Core submit ────────────────────────────────────────────────────────────
  async function handleSubmit() {
    const question = input.value.trim();
    if (!question || isLoading) return;

    if (isWhoa(question)) {
      renderResponse('...whoa.', null, true);
      return;
    }

    setLoading(true);
    hideResponse();
    clearError();

    try {
      let data;
      if (MOCK_MODE) {
        data = await mockFetch(question);
      } else {
        const res = await fetch(WORKER_URL, {
          method: 'POST',
          headers: { 'Content-Type': 'application/json' },
          body: JSON.stringify({ question }),
        });
        if (!res.ok) {
          const body = await res.json().catch(() => ({}));
          throw new Error(body?.error || `Error ${res.status}`);
        }
        data = await res.json();
      }
      renderResponse(data.wisdom, data.gif);
    } catch (err) {
      console.error(err);
      showError(err.message || 'Something went sideways. Try again.');
    } finally {
      setLoading(false);
    }
  }

  // ── Render response + GIF ──────────────────────────────────────────────────
  function renderResponse(wisdom, gif, isEasterEgg = false) {
    currentResponse = wisdom;

    responseCard.classList.remove('whoa-mode');
    if (isEasterEgg) responseCard.classList.add('whoa-mode');

    responseText.textContent = wisdom;

    // GIF
    responseGif.innerHTML = '';
    responseGif.classList.remove('visible');

    if (gif?.url) {
      const img = document.createElement('img');
      img.src = gif.url;
      img.alt = gif.title || 'Keanu Reeves';
      img.loading = 'lazy';

      const credit = document.createElement('div');
      credit.className = 'gif-credit';
      credit.innerHTML = `<a href="https://giphy.com" target="_blank" rel="noopener noreferrer" aria-label="Powered by GIPHY"><img src="/poweredby_giphy.gif" alt="Powered by GIPHY" /></a>`;

      if (gif.giphyPage) {
        const link = document.createElement('a');
        link.href = gif.giphyPage;
        link.target = '_blank';
        link.rel = 'noopener noreferrer';
        link.appendChild(img);
        responseGif.appendChild(link);
      } else {
        responseGif.appendChild(img);
      }

      responseGif.appendChild(credit);

      img.onload = () => {
        requestAnimationFrame(() => responseGif.classList.add('visible'));
      };
      // Show even if already cached
      if (img.complete) {
        requestAnimationFrame(() => responseGif.classList.add('visible'));
      }
    }

    showResponseCard();
  }

  // ── UI helpers ─────────────────────────────────────────────────────────────
  function showResponseCard() {
    responseCard.classList.remove('visible');
    void responseCard.offsetWidth;
    requestAnimationFrame(() => responseCard.classList.add('visible'));
  }

  function hideResponse() {
    responseCard.classList.remove('visible');
    responseGif.classList.remove('visible');
  }

  function setLoading(loading) {
    isLoading = loading;
    submitBtn.disabled = loading;
    input.disabled = loading;
    thinkingEl.classList.toggle('active', loading);
    submitBtn.textContent = loading ? '...' : 'Ask';
  }

  function resetForm() {
    hideResponse();
    setTimeout(() => {
      responseText.textContent = '';
      responseGif.innerHTML = '';
      currentResponse = '';
    }, 300);
    input.value = '';
    input.style.height = 'auto';
    input.disabled = false;
    input.focus();
    clearError();
    setExamplePrompt();
  }

  function showError(msg) {
    errorMsg.textContent = msg;
    errorMsg.classList.add('visible');
  }

  function clearError() {
    errorMsg.textContent = '';
    errorMsg.classList.remove('visible');
  }

  async function handleShare() {
    if (!currentResponse) return;
    const text = `"${currentResponse}"\n\n— whatwouldkeanudo.com`;
    try {
      await navigator.clipboard.writeText(text);
      const orig = shareBtn.innerHTML;
      shareBtn.textContent = 'Copied';
      setTimeout(() => { shareBtn.innerHTML = orig; }, 2000);
    } catch {
      // clipboard not available in all contexts
    }
  }

  // ── Particle canvas ────────────────────────────────────────────────────────
  const canvas = document.getElementById('canvas');
  const ctx = canvas.getContext('2d');
  let particles = [];

  function resize() {
    canvas.width = window.innerWidth;
    canvas.height = window.innerHeight;
  }

  function createParticle() {
    return {
      x: Math.random() * canvas.width,
      y: Math.random() * canvas.height,
      r: Math.random() * 1.2 + 0.3,
      vx: (Math.random() - 0.5) * 0.12,
      vy: (Math.random() - 0.5) * 0.12,
      alpha: Math.random() * 0.4 + 0.1,
      pulse: Math.random() * Math.PI * 2,
      pulseSpeed: Math.random() * 0.008 + 0.004,
    };
  }

  function initParticles() {
    const count = Math.min(80, Math.floor((canvas.width * canvas.height) / 12000));
    particles = Array.from({ length: count }, createParticle);
  }

  function drawParticles() {
    ctx.clearRect(0, 0, canvas.width, canvas.height);
    for (const p of particles) {
      p.pulse += p.pulseSpeed;
      const alpha = p.alpha * (0.6 + 0.4 * Math.sin(p.pulse));
      ctx.beginPath();
      ctx.arc(p.x, p.y, p.r, 0, Math.PI * 2);
      ctx.fillStyle = `rgba(200, 150, 62, ${alpha})`;
      ctx.fill();
      p.x += p.vx;
      p.y += p.vy;
      if (p.x < -5) p.x = canvas.width + 5;
      if (p.x > canvas.width + 5) p.x = -5;
      if (p.y < -5) p.y = canvas.height + 5;
      if (p.y > canvas.height + 5) p.y = -5;
    }
    requestAnimationFrame(drawParticles);
  }

  window.addEventListener('resize', () => { resize(); initParticles(); });
  resize();
  initParticles();
  drawParticles();
</script>
</body>
</html>
